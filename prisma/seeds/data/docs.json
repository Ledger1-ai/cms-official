[
    {
        "title": "Introduction to BasaltCMS",
        "slug": "introduction",
        "category": "Getting Started",
        "type": "docs",
        "content": "# Introduction to BasaltCMS\n\n## What is BasaltCMS?\nBasaltCMS is a high-performance, developer-first Content Management System. Unlike traditional monolithic CMS platforms, BasaltCMS leverages the power of **Next.js 15 (App Router)** and **React Server Components** to deliver content with zero client-side JavaScript overhead where possible.\n\n## Architecture Overview\nHow data flows from the database to the user's screen:\n\n```mermaid\ngraph TD\n    User[User Request] --> Edge[Edge Network / CDN]\n    Edge --> Next[Next.js App Server]\n    Next --> ServerActions[Server Actions / API]\n    ServerActions --> Prisma[Prisma ORM]\n    Prisma --> DB[(PostgreSQL Database)]\n    Next --> Cache[Vercel Data Cache]\n```\n\n## Key Features\n\n- **Visual Editor**: Real-time content editing with a drag-and-drop interface powered by our custom visual blocks engine.\n- **AI Assistant**: Built-in AI tools analyze your text in real-time, offering suggestions to improve clarity, tone, and SEO. This \"genius mode\" significantly boosts content output quality and velocity.\n- **Vendor Compliance (VCMS)**: Manage vendor profiles, compliance documents, and validation with AI-powered checks.\n- **Type-Safe Content**: Fully typed schemas using Prisma and TypeScript ensure your content structure is rigid and reliable.\n- **Asset Management**: Integrated media library for managing images, videos, and documents.",
        "videoUrl": null,
        "resources": {},
        "order": 1
    },
    {
        "title": "Vendor Compliance (VCMS)",
        "slug": "vendor-compliance",
        "category": "Core Concepts",
        "type": "docs",
        "content": "# Vendor Compliance Management System (VCMS)\n\n## Overview\nThe VCMS module allows organizations to manage vendor relationships, track compliance documentation, and ensure adherence to safety standards.\n\n## Compliance Logic\nHow the system determines if a vendor is compliant:\n\n```typescript\n// Pseudo-code for Compliance Calculation\nfunction calculateScore(vendor) {\n  let score = 0;\n  // 1. Base identity verification\n  if (vendor.status === 'VALIDATED') score += 20;\n  \n  // 2. Document checks\n  const requiredDocs = ['W9', 'COI', 'MSA'];\n  for (const doc of requiredDocs) {\n    if (vendor.docs.has(doc) && !doc.isExpired) {\n      score += 20;\n    }\n  }\n  \n  // 3. Penalty for expired docs\n  if (vendor.hasExpiredDocs) score -= 15;\n  \n  return Math.max(0, Math.min(100, score));\n}\n```\n\n## AI Scanning\nThe system includes an \"AI Scanner\" in the Media Library. Uploading a business card image automatically:\n1.  Extracts contact details (Name, Email, Phone, Company).\n2.  Performs a background check for basic compliance flags.\n3.  Creates a Draft Vendor Profile for review.",
        "videoUrl": null,
        "resources": {},
        "order": 2
    },
    {
        "title": "System Architecture",
        "slug": "system-architecture",
        "category": "Architecture",
        "type": "docs",
        "content": "# System Architecture\n\n## Core Technologies\n\n- **Next.js 15 (App Router)**: The backbone of the application, handling routing, SSR, and API endpoints.\n- **Prisma ORM**: Manages database access and schema definitions.\n- **Tailwind CSS**: Utility-first styling engine.\n- **Shadcn/UI**: Accessible, reusable component primitives.\n- **NextAuth.js**: Authentication and session management.\n\n## Middleware & Proxy Strategy\nDue to Next.js 15 middleware limitations with Edge runtimes, we use a specialized `proxy.ts` helper for route protection.\n\n### Request Flow\n1.  **Incoming Request**: User hits `/cms/dashboard`.\n2.  **Layout Check**: The root layout calls `auth()`.\n3.  **Redirect**: If no session exists, server component redirects to `/login`.\n\n## Edge Caching strategy\nWe typically use `unstable_cache` for high-frequency reads:\n- **Tags**: We assign cache tags like `['site-config']` or `['blog-posts']`.\n- **Revalidation**: On mutation (e.g., updating a post), we call `revalidateTag('blog-posts')` to purge the cache.",
        "videoUrl": null,
        "resources": {},
        "order": 3
    },
    {
        "title": "Content Management",
        "slug": "content-management",
        "category": "Core Concepts",
        "type": "docs",
        "content": "# Content Management\n\n## The Visual Editor\nBasaltCMS introduces a unique \"Block-Based\" visual editor for creating rich content pages.\n\n## Block Schema\nEvery visual block implements a strict schema definition for type safety.\n\n```typescript\n// Example Block Schema\nconst HeroBlock = {\n  type: \"hero\",\n  fields: {\n    title: { type: \"text\", required: true },\n    image: { type: \"image_url\" },\n    cta: {\n      type: \"object\",\n      structure: { label: \"text\", url: \"text\" }\n    }\n  },\n  render: (props) => <HeroComponent {...props} />\n}\n```\n\n## Hydration Strategy\nTo keep performance high:\n- **Server Components**: The initial page render is 100% HTML.\n- **Lazy Hydration**: Complex interactive blocks (like Carousels) are hydrated only when they enter the viewport.\n- **Client Only**: Use `<ClientOnly>` wrappers for blocks that rely on `window` or `document` APIs.",
        "videoUrl": null,
        "resources": {},
        "order": 4
    },
    {
        "title": "Database Schema (CMS)",
        "slug": "cms-database-schema",
        "category": "Architecture",
        "type": "docs",
        "content": "# Database Schema (CMS)\n\n## System Models\nThese core models power the CMS functionality:\n\n### Performance Indexes\nTo ensure fast query times, we apply the following indexes:\n- **`@@index([slug])`**: On `BlogPost` and `DocArticle` for fast URL lookups.\n- **`@@index([authorId])`**: For filtering lists by user.\n- **`@@index([status, publishedAt])`**: For sorting the main blog feed.\n\n### Recursive Relations\nThe Header system uses a recursive self-relation:\n\n```prisma\nmodel HeaderItem {\n  id        String       @id @default(uuid())\n  children  HeaderItem[] @relation(\"ParentChild\")\n  parent    HeaderItem?  @relation(\"ParentChild\", fields: [parentId], references: [id])\n  parentId  String?\n}\n```\nAllows: `Header -> Dropdown -> Nested Item -> Deep Link`.",
        "videoUrl": null,
        "resources": {},
        "order": 5
    },
    {
        "title": "Authentication",
        "slug": "authentication",
        "category": "Security",
        "type": "docs",
        "content": "# Authentication\n\n## Setup\nAuthentication is securely handled by **NextAuth.js** (v5 beta).\n\n## Session Strategy\n- **Strategy**: `jwt` (Stateless).\n- **Token**: Encrypted JWE (JSON Web Encryption).\n- **Duration**: 30 days.\n\n## Role Matrix\n\n| Permission | Owner | Admin | Editor | Viewer |\n|------------|-------|-------|--------|--------|\n| Login | ✅ | ✅ | ✅ | ✅ |\n| View Content | ✅ | ✅ | ✅ | ✅ |\n| Edit Content | ✅ | ✅ | ✅ | ❌ |\n| Configure Settings | ✅ | ✅ | ❌ | ❌ |\n| Invite Users | ✅ | ✅ | ❌ | ❌ |\n| Delete Owner | ❌ | ❌ | ❌ | ❌ |\n\n## Protecting Routes\nSecure usage in Server Components:\n```typescript\nimport { auth } from \"@/auth\";\n\nexport async function Page() {\n  const session = await auth();\n  if (!session || session.user.role !== 'ADMIN') {\n    return <div>Access Denied</div>\n  }\n  // ...\n}\n```",
        "videoUrl": null,
        "resources": {},
        "order": 6
    },
    {
        "title": "Global Styling & Theming",
        "slug": "global-styling",
        "category": "Theming",
        "type": "docs",
        "content": "# Global Styling & Theming\n\n## Tailwind Configuration\nThe project extends `tailwind.config.ts` with brand tokens.\n\n### Design Tokens\nUsage: `className=\"bg-primary text-primary-foreground\"`\n\n| Token | Value | usage |\n|-------|-------|-------|\n| `--background` | `0 0% 100%` | Page background |\n| `--foreground` | `222.2 84% 4.9%` | Main text color |\n| `--primary` | `222.2 47.4% 11.2%` | Main buttons, active states |\n| `--radius` | `0.5rem` | Border radius for cards/inputs |\n\n## Dark Mode First\nBasaltCMS is designed as a dark-mode first experience.\n- **Glassmorphism**: `bg-white/5 backdrop-blur-md` is used extensively for panels.\n- **Borders**: Detailed 1px borders with `border-white/10` add depth.\n\n## Animation Utilities\nCustom utilities for micro-interactions:\n- `.animate-in`: Fade in entry.\n- `.zoom-in-95`: Subtle scale up.\n- `.slide-in-from-bottom-2`: Upward slide entry.",
        "videoUrl": null,
        "resources": {},
        "order": 7
    },
    {
        "title": "API Reference",
        "slug": "api-reference",
        "category": "Development",
        "type": "docs",
        "content": "# API Reference\n\n## Response Standard\nAll API endpoints follow the `JSend` style (or similar):\n\n```json\n{\n  \"status\": \"success\",\n  \"data\": { ... },\n  \"meta\": {\n    \"page\": 1,\n    \"total\": 50\n  }\n}\n```\n\n## Error Codes\n| Code | Meaning | Cause |\n|------|---------|-------|\n| `400` | Bad Request | Validation error (missing fields). |\n| `401` | Unauthorized | No session token found. |\n| `403` | Forbidden | Session exists but role is insufficient. |\n| `429` | Too Many Requests | Rate limit exceeded (100/min). |\n\n## Internal API Routes\n- **`GET /api/articles`**: List all articles.\n- **`POST /api/upload`**: Upload a file (Multipart form data).",
        "videoUrl": null,
        "resources": {},
        "order": 8
    },
    {
        "title": "Deployment",
        "slug": "deployment",
        "category": "Guides",
        "type": "docs",
        "content": "# Deployment\n\n## Environment Variables\nThese keys must be present in production:\n\n| Key | Description |\n|-----|-------------|\n| `DATABASE_URL` | PostgreSQL connection string (Pooling enabled). |\n| `NEXTAUTH_SECRET` | OpenSSL generated random string. |\n| `NEXTAUTH_URL` | Canonical URL of the site (`https://...`). |\n| `UPLOADTHING_SECRET` | Secret for file upload services (if using UploadThing). |\n| `OPENAI_API_KEY` | (Optional) Fallback key for AI services. |\n\n## Docker Deployment\nStandard Text for optimizing Docker images:\n```dockerfile\n# ... previous steps ...\n# Standalone builder optimization\nENV NEXT_PRIVATE_STANDALONE true\n\nCOPY --from=builder /app/.next/standalone ./\nCOPY --from=builder /app/.next/static ./.next/static\n\nEXPOSE 3000\nCMD [\"node\", \"server.js\"]\n```",
        "videoUrl": null,
        "resources": {},
        "order": 9
    },
    {
        "title": "Apps & Plugins Architecture",
        "slug": "apps-architecture",
        "category": "Integrations",
        "type": "docs",
        "content": "# Apps & Plugins Architecture\n\n## Encryption at Rest\nWe use **AES-256-CBC** to encrypt sensitive credentials.\n\n### Implementation\n```typescript\nimport { createCipheriv } from 'crypto';\n\nconst algorithm = 'aes-256-cbc';\nconst key = Buffer.from(process.env.ENCRYPTION_KEY, 'hex');\n\nexport function encrypt(text) {\n  const iv = crypto.randomBytes(16);\n  const cipher = createCipheriv(algorithm, key, iv);\n  // ... returns { iv, content }\n}\n```\n\n## Connection Flow (OAuth)\n1.  **User Client**: Clicks \"Connect Shopify\".\n2.  **Server Action**: Redirects to `shopify.com/oauth/authorize?scope=...`.\n3.  **Callback**: Shopify redirects back to `/api/apps/callback/shopify` with `code`.\n4.  **Token Exchange**: Server swaps `code` for `access_token`.\n5.  **Encryption**: Token is encrypted and saved to `AppConnection`.",
        "videoUrl": null,
        "resources": {},
        "order": 10
    },
    {
        "title": "User & Team Management",
        "slug": "user-team-management",
        "category": "Core Concepts",
        "type": "docs",
        "content": "# User & Team Management\n\n## Permission Resolution\nHow we determine if a user can access a feature:\n\n```typescript\nfunction canUserAccess(user, module) {\n  // 1. Check strict role\n  if (user.role === 'OWNER') return true;\n  \n  // 2. Check Module Override\n  if (user.moduleOverrides[module] === true) return true;\n  if (user.moduleOverrides[module] === false) return false;\n  \n  // 3. Fallback to Role Default\n  return ROLE_DEFAULTS[user.role][module];\n}\n```\n\n## Audit Schema\nEvery activity is logged with this JSON structure:\n```json\n{\n  \"actorId\": \"user_123\",\n  \"action\": \"UPDATE\",\n  \"resource\": \"BlogPost\",\n  \"resourceId\": \"post_789\",\n  \"metadata\": {\n    \"field\": \"title\",\n    \"oldValue\": \"Draft\",\n    \"newValue\": \"Final\"\n  },\n  \"timestamp\": \"2024-01-01T12:00:00Z\"\n}\n```",
        "videoUrl": null,
        "resources": {},
        "order": 11
    },
    {
        "title": "Form Builder",
        "slug": "form-builder",
        "category": "Features",
        "type": "docs",
        "content": "# Form Builder\n\n## Data Validation\nForms perform both client-side and server-side validation.\n- **Email**: Regex validation `^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$`.\n- **Required**: Checks for non-empty string.\n- **Max Length**: Prevention of buffer overflow attacks (max 5000 chars for text areas).\n\n## Webhook Payloads\nWhen a form is submitted, we POST this JSON to configured webhooks:\n```json\n{\n  \"formId\": \"form_abc\",\n  \"submissionId\": \"sub_xyz\",\n  \"data\": {\n    \"email\": \"user@example.com\",\n    \"message\": \"Hello world\"\n  },\n  \"submittedAt\": \"ISO_DATE_STRING\"\n}\n```",
        "videoUrl": null,
        "resources": {},
        "order": 12
    },
    {
        "title": "Echo (Universal Voice)",
        "slug": "echo-voice",
        "category": "Features",
        "type": "docs",
        "content": "# Echo (Universal Voice)\n\n## Architecture\nEcho uses a WebSocket connection to stream audio data.\n\n### WebSocket Protocol\n1.  **Client**: Sends `{\"type\": \"audio_chunk\", \"data\": \"base64...\"}`.\n2.  **Server (VAD)**: Voice Activity Detection determines end of speech.\n3.  **Server (LLM)**: Transcribes -> Thinks -> Streams text response.\n4.  **Server (TTS)**: Converts text to audio chunks -> Sends back to client.\n\n## Security Limits\nTo prevent abuse:\n- **Max Duration**: 60 seconds per turn.\n- **Rate Limit**: 50 turns per hour per user.\n- **Cost Control**: Admins can set a hard `spend_limit` (USD) per user in the database.",
        "videoUrl": null,
        "resources": {},
        "order": 13
    },
    {
        "title": "Footer & SEO Management",
        "slug": "footer-seo-management",
        "category": "Features",
        "type": "docs",
        "content": "# Footer & SEO Management\n\n## JSON-LD Structured Data\nTo improve SEO, we automatically inject Schema.org JSON-LD.\n\n### Example Output (Organization)\n```json\n{\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"Organization\",\n  \"name\": \"Basalt\",\n  \"url\": \"https://basalt.com\",\n  \"logo\": \"https://basalt.com/logo.png\",\n  \"sameAs\": [\n    \"https://twitter.com/basalt\",\n    \"https://linkedin.com/company/basalt\"\n  ]\n}\n```\n\n## Automated Meta Tags\nThe system automatically generates:\n- `<meta name=\"robots\" content=\"index, follow\">`\n- `<link rel=\"canonical\" href=\"...\">`\n- `<meta property=\"og:type\" content=\"website\">`",
        "videoUrl": null,
        "resources": {},
        "order": 14
    },
    {
        "title": "WordPress Integration",
        "slug": "wordpress-integration",
        "category": "Integrations",
        "type": "docs",
        "content": "# WordPress Integration\n\n## Sync Logic\nHow we parse WordPress HTML into Basalt Blocks:\n\n1.  **Fetch**: `GET /wp-json/wp/v2/posts/[id]`.\n2.  **Parse HTML**: Use `cheerio` or `jsdom` to traverse the content.\n3.  **Heuristics**:\n    - `<p>` tags -> Rich Text Block.\n    - `<img>` tags -> Media Block.\n    - `<blockquote>` -> Testimonial Block.\n4.  **Construct JSON**: Build the Puck-compatible data structure.\n\n## API Endpoints Consumed\n- `GET /wp-json/wp/v2/posts`\n- `GET /wp-json/wp/v2/media`\n- `POST /wp-json/wp/v2/posts` (For creating content from CMS -> WP).",
        "videoUrl": null,
        "resources": {},
        "order": 15
    },
    {
        "title": "Blog Analytics",
        "slug": "blog-analytics",
        "category": "Features",
        "type": "docs",
        "content": "# Blog Analytics\n\n## Data Aggregation\nWe do not query raw logs on every dashboard load. Instead, we use a materialized view or scheduled aggregation.\n\n- **Raw Table**: `AnalyticsEvent` (Million rows).\n- **Daily Table**: `DailyAnalytics` (One row per post per day).\n  - `date`, `postId`, `clickCount`, `shareCount`.\n\n## Privacy & Cookies\n- **No PII**: We do not store IP addresses or User Agents in the analytics table.\n- **CookieUtils**: We use a `viewed_posts` local storage array to prevent counting duplicate views from the same session.",
        "videoUrl": null,
        "resources": {},
        "order": 16
    },
    {
        "title": "Careers & Jobs Module",
        "slug": "careers-jobs",
        "category": "Features",
        "type": "docs",
        "content": "# Careers & Jobs Module\n\n## Google Jobs Schema\nJob postings automatically render `JobPosting` structured data for Google Jobs.\n\n### Critical Fields\n- `datePosted`: ISO 8601 format.\n- `validThrough`: Expiry date.\n- `employmentType`: \"FULL_TIME\", \"PART_TIME\".\n\n## API Access\nDevelopers can build custom career pages using the public API:\n- `GET /api/public/jobs`: Returns JSON list of active jobs.\n- `POST /api/public/jobs/apply`: Endpoint for submitting applications (Handling file uploads for resumes).",
        "videoUrl": null,
        "resources": {},
        "order": 17
    },
    {
        "title": "Landing Pages Builder",
        "slug": "landing-pages",
        "category": "Features",
        "type": "docs",
        "content": "# Landing Pages Builder\n\n## Render Strategy\nLanding pages use **On-Demand ISR** (Incremental Static Regeneration).\n- **Build Time**: Pages are not built at deployment time to speed up builds.\n- **First Request**: Generated Server-Side and cached.\n- **Subsequent Requests**: Served from Cache.\n- **On Edit**: Calling `revalidatePath('/[slug]')` invalidates the specific page cache.\n\n## Image Optimization\nAll images dropped into the editor are automatically optimized:\n- **Format**: Converted to WebP/AVIF.\n- **Sizes**: `srcSet` generated for responsive loading.\n- **Lazy**: `loading=\"lazy\"` applied to all images below the fold.",
        "videoUrl": null,
        "resources": {},
        "order": 18
    },
    {
        "title": "Subscriptions & Newsletter",
        "slug": "subscriptions-newsletter",
        "category": "Features",
        "type": "docs",
        "content": "# Subscriptions & Newsletter\n\n## Email Infrastructure\nWe abstract the provider layer. Current supported drivers:\n- **Resend**: Default. High deliverability.\n- **AWS SES**: Cheaper for high volume.\n- **SMTP**: Generic fallback.\n\n## Queueing System\nTo handle large lists (e.g., 10k subscribers):\n1.  **Job Creation**: The campaign creation puts a \"Job\" in the database.\n2.  **Cron Worker**: A background worker picks up the job.\n3.  **Batching**: Emails are sent in batches of 50 to avoid timeouts and rate limits.\n4.  **Idempotency**: We track `sentTo` list to prevent duplicate emails if the job restarts.",
        "videoUrl": null,
        "resources": {},
        "order": 19
    },
    {
        "title": "FAQ Manager",
        "slug": "faq-manager",
        "category": "Features",
        "type": "docs",
        "content": "# FAQ Manager\n\n## Search Algorithm\nWhen users search the FAQ help center:\n- **PostgreSQL**: We use `plainto_tsquery` for full-text search capability.\n- **Ranking**: Matches in the `Question` are weighted 2x higher than matches in the `Answer`.\n\n## Schema.org output\nThe FAQ page automatically renders `FAQPage` schema:\n```json\n{\n  \"@type\": \"FAQPage\",\n  \"mainEntity\": [\n    {\n      \"@type\": \"Question\",\n      \"name\": \"How do I reset my password?\",\n      \"acceptedAnswer\": { \"@type\": \"Answer\", \"text\": \"...\" }\n    }\n  ]\n}\n```",
        "videoUrl": null,
        "resources": {},
        "order": 20
    },
    {
        "title": "Activity Log & Audit Trail",
        "slug": "activity-log",
        "category": "System",
        "type": "docs",
        "content": "# Activity Log & Audit Trail\n\n## Immutability Guarantees\nThe integrity of the audit log is critical.\n- **Database Level**: The database user for the application has `INSERT` and `SELECT` permissions on the `ActivityLog` table, but `NO UPDATE` or `DELETE` permissions.\n- **Code Level**: No API endpoints exist to modifying log entries.\n\n## Retention Policies\n- **Default**: Logs are kept for infinity (Database storage is cheap).\n- **Configuration**: Enterprises can configure a \"Ttl\" (Time To Live) to auto-archive logs older than 1 year to cold storage (S3 Glacier).",
        "videoUrl": null,
        "resources": {},
        "order": 21
    },
    {
        "title": "Media Library Advanced Features",
        "slug": "media-library-advanced",
        "category": "Features",
        "type": "docs",
        "content": "# Media Library Advanced Features\n\n## Processing Pipeline\n1.  **Upload**: File arrives at `/api/upload`.\n2.  **Detection**: `sharp` library detects dimensions and format.\n3.  **Thumbnails**: 3 variants generated (thumbnail, medium, large).\n4.  **Storage**: Files uploaded to `/uploads/[year]/[month]/hash.ext`.\n\n## Storage Structure\nWe use a content-addressable storage-like structure.\n- **Deduping**: If two users upload the same file (same hash), we point to the same physical file but create two `MediaItem` database records.",
        "videoUrl": null,
        "resources": {},
        "order": 22
    },
    {
        "title": "Header System Architecture",
        "slug": "header-system-architecture",
        "category": "Architecture",
        "type": "docs",
        "content": "# Header System Architecture\n\n## Cache Revalidation Flow\nSequence of events for updates:\n\n1.  **Admin Action**: User updates menu order -> `POST /server-action/update-header`.\n2.  **DB Update**: `prisma.headerItem.update(...)`.\n3.  **Revalidate**: `revalidateTag('header-config')`.\n4.  **Next Request**: The cache for the header component is STALE.\n5.  **Re-render**: Server fetches fresh data from DB and stores in cache.\n\n## Recursive Rendering\nReact Component Logic:\n```jsx\nfunction MenuItem({ item }) {\n  if (item.children.length > 0) {\n    return (\n      <Dropdown>\n        <Trigger>{item.label}</Trigger>\n        <Content>\n          {item.children.map(child => <MenuItem item={child} />)}\n        </Content>\n      </Dropdown>\n    )\n  }\n  return <Link href={item.url}>{item.label}</Link>\n}\n```",
        "videoUrl": null,
        "resources": {},
        "order": 23
    }
]